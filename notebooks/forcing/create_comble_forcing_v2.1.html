

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Code to generate: initial and time-varying profile and surface forcing &#8212; COMBLE Model-Observation Intercomparison Project</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/forcing/create_comble_forcing_v2.1';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Example: convert DEPHY forcing to DHARMA and ModelE3 forcings" href="../conversion/convert_comble_dephy_forcing_to_DHARMA_LES_and_ModelE3_SCM_forcing.html" />
    <link rel="prev" title="Contributers Guide" href="../../CONTRIBUTING.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/arm_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/arm_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    COMBLE Model-Observation Intercomparison Project Cookbook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Participants</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../participants/participants_list.html">Read Participants List Google Sheet</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">How-To</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../howto/workbench_instructions.html">Apply for Elevated JupyterHub Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING.html">Contributers Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DEPHY Forcing Notebooks</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Code to generate: initial and time-varying profile and surface forcing</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Input Conversion Notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../conversion/convert_comble_dephy_forcing_to_DHARMA_LES_and_ModelE3_SCM_forcing.html">Example: convert DEPHY forcing to DHARMA and ModelE3 forcings</a></li>

<li class="toctree-l1"><a class="reference internal" href="../conversion/convert_comble_dephy_forcing_to_WRF_LES_forcing.html">Example: convert DEPHY forcing to WRF-LES forcing</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model Setup</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../setup/read-metadata-sheet.html">Read Metadata Google Sheet</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model Output Requested</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../output/output_list.html">Read Output List Google Sheet</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Output Conversion Notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../conversion_output/convert_DHARMA_LES_output_to_dephy_format.html">Example: convert DHARMA LES output to DEPHY format</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://jupyterhub.arm.gov/hub/user-redirect/git-pull?repo=https%3A//github.com/ARM-Development/comble-mip&urlpath=lab/tree/comble-mip/../user-data-home/comble-mip/notebooks/forcing/create_comble_forcing_v2.1.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/forcing/create_comble_forcing_v2.1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Code to generate: initial and time-varying profile and surface forcing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Code to generate: initial and time-varying profile and surface forcing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#developed-by-tim-juliano-ncar-ral-ann-fridlind-nasa-giss-and-florian-tornow-nasa-giss-columbia-univ">Developed by Tim Juliano (NCAR-RAL), Ann Fridlind (NASA-GISS), and Florian Tornow (NASA-GISS/Columbia Univ.)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#with-substantial-contributions-by-peng-wu-pnnl-gunilla-svensson-stockholm-univ-and-andy-ackerman-nasa-giss">with substantial contributions by Peng Wu (PNNL), Gunilla Svensson (Stockholm Univ.), and Andy Ackerman (NASA-GISS)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#v2-1-created-on-6-6-23">v2.1 created on 6/6/23</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#based-on-era5-backward-trajectory-beginning-at-andenes-norway-03-13-20-at-18-utc">Based on ERA5 backward trajectory, beginning at Andenes, Norway (03/13/20 at 18 UTC)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#we-have-the-option-of-starting-as-far-as-28-hours-before-arriving-at-andenes-03-12-20-at-14-utc">We have the option of starting as far as 28 hours before arriving at Andenes (03/12/20 at 14 UTC)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries">Import libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#begin-user-mods">!!! Begin user mods !!!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-hours-before-ice-edge-do-you-want-to-start">1. How many hours before ice edge do you want to start?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-value-0-means-you-are-starting-approx-at-ice-edge-value-10-means-you-are-starting-10-h-upstream-north-of-the-ice-edge">Note: Value == 0 means you are starting approx. at ice edge, Value == 10 means you are starting 10 h upstream (north) of the ice edge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-value-must-be-an-integer">Note: Value must be an integer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-t0-h-represents-simulation-start-time-t0-h-init-th-qv-represents-initial-theta-qv-profile-to-use-set-equivalent-if-everything-should-be-initialized-using-information-at-same-time">Note: t0_h represents simulation start time, t0_h_init_th_qv represents initial theta/qv profile to use; set equivalent if everything should be initialized using information at same time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clobber-old-forcing-file">2. Clobber old forcing file?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forcing-file-save-name">3. Forcing file save name</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-for-this-and-all-file-paths-include-directory-in-the-name">Note: For this and all file paths, include directory in the name</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#name-of-current-script-for-global-attribute">4. Name of current script for global attribute</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-can-use-ipynbname-library-to-automatically-generate-script-name-but-this-is-not-a-standard-library-so-skipping-for-now">Note: Can use ipynbname library to automatically generate script name, but this is not a standard library so skipping for now</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-domain-locations">5. LES domain locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#era5-backward-trajectory-met-file-name">6. ERA5 backward trajectory met file name</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#era5-backward-trajectory-ozone-file-name">7. ERA5 backward trajectory ozone file name</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-model-profiles-file-name">8. 1D model profiles file name</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sea-ice-concentration-file-name">9. Sea ice concentration file name</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-geostrophic-wind-calc-and-add-to-forcing-file-if-so-supply-era5-geopotential-height-file-name-and-minimum-grid-spacing-km-for-discretization">10. Do geostrophic wind calc and add to forcing file? If so, supply ERA5 geopotential height file name and minimum grid spacing (km) for discretization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-theta-and-qv-nudging-as-well-as-subsidence-to-forcing-file">11. Add theta and qv nudging, as well as subsidence, to forcing file?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#end-user-mods">!!! End user mods !!!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-some-things">Set some things</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timings">Timings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constants-for-geostrophic-wind-calc">Constants for geostrophic wind calc</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-forcing-file-if-already-exists">Delete forcing file if already exists</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-les-domain-locations">Get LES domain locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-vertical-grid">Create vertical grid</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#vertical-grid-levels-defined-at-the-cell-faces">160 vertical grid levels, defined at the cell faces</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-in-data-from-era5-backtrajectory-netcdf">Read in data from ERA5 backtrajectory (netCDF)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-units">Convert units</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reverse-time-dimension-of-2d-arrays-as-well-as-sfc-pressure-and-sst-so-that-beginning-of-backward-trajectory-is-in-first-position">Reverse time dimension of 2D arrays, as well as sfc pressure and sst, so that beginning of backward trajectory is in first position</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unmask-sst-field-and-get-index-according-to-t0-h-furthest-north-we-can-go-is-28h-after-backtrajectory-initialization-from-andenes-or-3-12-20-at-14-utc">Unmask sst field and get index according to t0_h (furthest north we can go is 28h after backtrajectory initialization from Andenes, or 3/12/20 at 14 UTC)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-sfc-potential-temperature">Calculate sfc potential temperature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-information-at-t0">Get information at t0</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extrapolate-o3-since-era5-only-goes-to-1-hpa-and-plot-versus-original-profile">Extrapolate O3 since ERA5 only goes to 1 hPa and plot versus original profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-geostrophic-wind-forcing">Get Geostrophic wind forcing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolate-extrapolate-ug-vg-to-native-era5-levels">Interpolate/extrapolate Ug/Vg to native ERA5 levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolate-t0-profiles-nudging-profiles-and-geostrophic-wind-profiles-to-common-vertical-grid-for-simplicity">Interpolate t0 profiles, nudging profiles, and geostrophic wind profiles to common vertical grid for simplicity</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#find-time-with-highest-first-level-and-get-vertical-grid">Find time with highest first level and get vertical grid</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#do-the-linear-interpolation-of-time-varying-geostrophic-profiles-to-new-vertical-grid">Do the linear interpolation of time-varying geostrophic profiles to new vertical grid</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-original-and-interpolated-profiles-of-time-varying-geostrophic-wind-as-example-to-show-efficacy-of-method">Compare original and interpolated profiles of time-varying geostrophic wind as example to show efficacy of method</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#do-the-linear-interpolation-for-initial-forcing-profiles">Do the linear interpolation for initial forcing profiles</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#do-the-linear-interpolation-for-nudging-forcing-profiles">Do the linear interpolation for nudging forcing profiles</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-original-and-interpolated-profiles-of-time-varying-nudging-wind-as-example-to-show-efficacy-of-method">Compare original and interpolated profiles of time-varying nudging wind as example to show efficacy of method</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#shift-profiles-downward-according-to-anns-method">Shift profiles downward according to Annâ€™s method</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smooth-shifted-initial-water-vapor-mixing-ratio-profile">Smooth shifted initial water vapor mixing ratio profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-1d-model-from-gunilla-svensson-approximate-deviation-from-geostrophy-and-add-offset-to-initial-geostrophic-winds-for-our-initial-wind-profile">Using 1D model from Gunilla Svensson, approximate deviation from geostrophy and add offset to initial geostrophic winds for our initial wind profile</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#do-sfc-forcing">DO SFC FORCING</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-sea-ice-concentration-along-trajectory">Calculate sea ice concentration along trajectory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-time-series-information-for-sfc-forcing">Get time series information for sfc forcing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-new-netcdf-file">Create new netcdf file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-dimensions">Create dimensions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-global-attributes">Create global attributes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-variables">Create variables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dimensions">Dimensions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-profiles">Initial profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-sfc-conditions">Initial sfc conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-forcing-geostrophic">Time-varying forcing - geostrophic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-forcing-nudging">Time-varying forcing - nudging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-forcing-surface">Time-varying forcing - surface</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-locations">Time-varying locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#misc">Misc</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#write-data">Write data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-times">Add times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#close-the-file">Close the file</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="code-to-generate-initial-and-time-varying-profile-and-surface-forcing">
<h1>Code to generate: initial and time-varying profile and surface forcing<a class="headerlink" href="#code-to-generate-initial-and-time-varying-profile-and-surface-forcing" title="Permalink to this heading">#</a></h1>
<section id="developed-by-tim-juliano-ncar-ral-ann-fridlind-nasa-giss-and-florian-tornow-nasa-giss-columbia-univ">
<h2>Developed by Tim Juliano (NCAR-RAL), Ann Fridlind (NASA-GISS), and Florian Tornow (NASA-GISS/Columbia Univ.)<a class="headerlink" href="#developed-by-tim-juliano-ncar-ral-ann-fridlind-nasa-giss-and-florian-tornow-nasa-giss-columbia-univ" title="Permalink to this heading">#</a></h2>
</section>
<section id="with-substantial-contributions-by-peng-wu-pnnl-gunilla-svensson-stockholm-univ-and-andy-ackerman-nasa-giss">
<h2>with substantial contributions by Peng Wu (PNNL), Gunilla Svensson (Stockholm Univ.), and Andy Ackerman (NASA-GISS)<a class="headerlink" href="#with-substantial-contributions-by-peng-wu-pnnl-gunilla-svensson-stockholm-univ-and-andy-ackerman-nasa-giss" title="Permalink to this heading">#</a></h2>
</section>
<section id="v2-1-created-on-6-6-23">
<h2>v2.1 created on 6/6/23<a class="headerlink" href="#v2-1-created-on-6-6-23" title="Permalink to this heading">#</a></h2>
</section>
<section id="based-on-era5-backward-trajectory-beginning-at-andenes-norway-03-13-20-at-18-utc">
<h2>Based on ERA5 backward trajectory, beginning at Andenes, Norway (03/13/20 at 18 UTC)<a class="headerlink" href="#based-on-era5-backward-trajectory-beginning-at-andenes-norway-03-13-20-at-18-utc" title="Permalink to this heading">#</a></h2>
</section>
<section id="we-have-the-option-of-starting-as-far-as-28-hours-before-arriving-at-andenes-03-12-20-at-14-utc">
<h2>We have the option of starting as far as 28 hours before arriving at Andenes (03/12/20 at 14 UTC)<a class="headerlink" href="#we-have-the-option-of-starting-as-far-as-28-hours-before-arriving-at-andenes-03-12-20-at-14-utc" title="Permalink to this heading">#</a></h2>
</section>
<section id="import-libraries">
<h2>Import libraries<a class="headerlink" href="#import-libraries" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="k">as</span> <span class="nn">ma</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">date2num</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">geopy.distance</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter1d</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="begin-user-mods">
<h2>!!! Begin user mods !!!<a class="headerlink" href="#begin-user-mods" title="Permalink to this heading">#</a></h2>
<section id="how-many-hours-before-ice-edge-do-you-want-to-start">
<h3>1. How many hours before ice edge do you want to start?<a class="headerlink" href="#how-many-hours-before-ice-edge-do-you-want-to-start" title="Permalink to this heading">#</a></h3>
</section>
<section id="note-value-0-means-you-are-starting-approx-at-ice-edge-value-10-means-you-are-starting-10-h-upstream-north-of-the-ice-edge">
<h3>Note: Value == 0 means you are starting approx. at ice edge, Value == 10 means you are starting 10 h upstream (north) of the ice edge<a class="headerlink" href="#note-value-0-means-you-are-starting-approx-at-ice-edge-value-10-means-you-are-starting-10-h-upstream-north-of-the-ice-edge" title="Permalink to this heading">#</a></h3>
</section>
<section id="note-value-must-be-an-integer">
<h3>Note: Value must be an integer<a class="headerlink" href="#note-value-must-be-an-integer" title="Permalink to this heading">#</a></h3>
</section>
<section id="note-t0-h-represents-simulation-start-time-t0-h-init-th-qv-represents-initial-theta-qv-profile-to-use-set-equivalent-if-everything-should-be-initialized-using-information-at-same-time">
<h3>Note: t0_h represents simulation start time, t0_h_init_th_qv represents initial theta/qv profile to use; set equivalent if everything should be initialized using information at same time<a class="headerlink" href="#note-t0-h-represents-simulation-start-time-t0-h-init-th-qv-represents-initial-theta-qv-profile-to-use-set-equivalent-if-everything-should-be-initialized-using-information-at-same-time" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t0_h</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">t0_h_init_th_qv</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">if</span> <span class="n">t0_h</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">t0_h</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Please set 0 &lt;= t0_h &gt;= 10&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="clobber-old-forcing-file">
<h3>2. Clobber old forcing file?<a class="headerlink" href="#clobber-old-forcing-file" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clobber_old_file</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="forcing-file-save-name">
<h3>3. Forcing file save name<a class="headerlink" href="#forcing-file-save-name" title="Permalink to this heading">#</a></h3>
<section id="note-for-this-and-all-file-paths-include-directory-in-the-name">
<h4>Note: For this and all file paths, include directory in the name<a class="headerlink" href="#note-for-this-and-all-file-paths-include-directory-in-the-name" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">save_name</span> <span class="o">=</span> <span class="s1">&#39;COMBLE_INTERCOMPARISON_FORCING_V2.1.nc&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="name-of-current-script-for-global-attribute">
<h3>4. Name of current script for global attribute<a class="headerlink" href="#name-of-current-script-for-global-attribute" title="Permalink to this heading">#</a></h3>
<section id="note-can-use-ipynbname-library-to-automatically-generate-script-name-but-this-is-not-a-standard-library-so-skipping-for-now">
<h4>Note: Can use ipynbname library to automatically generate script name, but this is not a standard library so skipping for now<a class="headerlink" href="#note-can-use-ipynbname-library-to-automatically-generate-script-name-but-this-is-not-a-standard-library-so-skipping-for-now" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">script_name</span> <span class="o">=</span> <span class="s1">&#39;create_comble_forcing_v2.1.ipynb&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="les-domain-locations">
<h3>5. LES domain locations<a class="headerlink" href="#les-domain-locations" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fname_les_domain</span> <span class="o">=</span> <span class="s1">&#39;LES_domain_location_28h_18Z_Mar13_2020.txt&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="era5-backward-trajectory-met-file-name">
<h3>6. ERA5 backward trajectory met file name<a class="headerlink" href="#era5-backward-trajectory-met-file-name" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fname_era5_met</span> <span class="o">=</span> <span class="s1">&#39;theta_temp_rh_sh_uvw_sst_along_trajectory_era5ml_28h_end_2020-03-13-18.nc&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="era5-backward-trajectory-ozone-file-name">
<h3>7. ERA5 backward trajectory ozone file name<a class="headerlink" href="#era5-backward-trajectory-ozone-file-name" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fname_era5_o3</span> <span class="o">=</span> <span class="s1">&#39;ERA5_forcing_along_trajectory_end_2020-03-13-18.nc&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="d-model-profiles-file-name">
<h3>8. 1D model profiles file name<a class="headerlink" href="#d-model-profiles-file-name" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">profiles_1d_model</span> <span class="o">=</span> <span class="s1">&#39;u_v_theta_z.txt&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sea-ice-concentration-file-name">
<h3>9. Sea ice concentration file name<a class="headerlink" href="#sea-ice-concentration-file-name" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fname_sic</span> <span class="o">=</span> <span class="s1">&#39;Svalbard_asi-AMSR2-n10m-20200313_m.nc&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="do-geostrophic-wind-calc-and-add-to-forcing-file-if-so-supply-era5-geopotential-height-file-name-and-minimum-grid-spacing-km-for-discretization">
<h3>10. Do geostrophic wind calc and add to forcing file? If so, supply ERA5 geopotential height file name and minimum grid spacing (km) for discretization<a class="headerlink" href="#do-geostrophic-wind-calc-and-add-to-forcing-file-if-so-supply-era5-geopotential-height-file-name-and-minimum-grid-spacing-km-for-discretization" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">do_geo</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="n">fname_era5_geo</span> <span class="o">=</span> <span class="s1">&#39;/glade/scratch/tjuliano/doe_comble/wrf_asr_cao/WRF-ASR-CAO/scripts/era5/era5_mar13_case_larger.nc&#39;</span>
    <span class="n">min_dx</span> <span class="o">=</span> <span class="mf">20.</span>
    <span class="n">min_dy</span> <span class="o">=</span> <span class="mf">20.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="add-theta-and-qv-nudging-as-well-as-subsidence-to-forcing-file">
<h3>11. Add theta and qv nudging, as well as subsidence, to forcing file?<a class="headerlink" href="#add-theta-and-qv-nudging-as-well-as-subsidence-to-forcing-file" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">do_u_v_nudge</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">do_th_qv_nudge</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">do_subsidence</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="end-user-mods">
<h2>!!! End user mods !!!<a class="headerlink" href="#end-user-mods" title="Permalink to this heading">#</a></h2>
</section>
<section id="set-some-things">
<h2>Set some things<a class="headerlink" href="#set-some-things" title="Permalink to this heading">#</a></h2>
<section id="timings">
<h3>Timings<a class="headerlink" href="#timings" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nhrs</span> <span class="o">=</span> <span class="mi">18</span> <span class="o">+</span> <span class="n">t0_h</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># total number of simulation hours, including t0</span>
<span class="k">if</span> <span class="n">t0_h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="s1">&#39;2020-03-13 00:00:00&#39;</span>
    <span class="n">start_day</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="n">start_hour</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="s1">&#39;2020-03-12 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">24</span><span class="o">-</span><span class="n">t0_h</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:00:00&#39;</span>
    <span class="n">start_day</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">start_hour</span> <span class="o">=</span> <span class="mi">24</span><span class="o">-</span><span class="n">t0_h</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Start time is: &#39;</span> <span class="o">+</span> <span class="n">start_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start time is: 2020-03-12 22:00:00
</pre></div>
</div>
</div>
</div>
</section>
<section id="constants-for-geostrophic-wind-calc">
<h3>Constants for geostrophic wind calc<a class="headerlink" href="#constants-for-geostrophic-wind-calc" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="mf">7.2921e-5</span> <span class="c1"># angular velocity</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span> <span class="c1"># grav constant</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="delete-forcing-file-if-already-exists">
<h3>Delete forcing file if already exists<a class="headerlink" href="#delete-forcing-file-if-already-exists" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">clobber_old_file</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_name</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">save_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The file &#39;</span> <span class="o">+</span> <span class="n">save_name</span> <span class="o">+</span> <span class="s1">&#39; has been deleted successfully&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The file COMBLE_INTERCOMPARISON_FORCING_V2.1.nc has been deleted successfully
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-les-domain-locations">
<h3>Get LES domain locations<a class="headerlink" href="#get-les-domain-locations" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">les_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname_les_domain</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">les_hh</span> <span class="o">=</span> <span class="n">les_loc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">les_hh_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">les_hh</span><span class="o">&gt;=-</span><span class="mf">1.</span><span class="o">*</span><span class="n">t0_h</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">les_lat</span> <span class="o">=</span> <span class="n">les_loc</span><span class="p">[</span><span class="n">les_hh_idx</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">les_lat2</span> <span class="o">=</span> <span class="n">les_lat</span><span class="p">[::</span><span class="mi">12</span><span class="p">]</span>
<span class="n">les_lon</span> <span class="o">=</span> <span class="n">les_loc</span><span class="p">[</span><span class="n">les_hh_idx</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">les_lon2</span> <span class="o">=</span> <span class="n">les_lon</span><span class="p">[::</span><span class="mi">12</span><span class="p">]</span>

<span class="n">les_lat_mid</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">les_lat</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="n">les_lon_mid</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">les_lon</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;LES domain mid point: &#39;</span> <span class="o">+</span> <span class="s1">&#39;lat=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">les_lat_mid</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;N, lon=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">les_lon_mid</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LES domain mid point: lat=74.5N, lon=9.9E
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-vertical-grid">
<h3>Create vertical grid<a class="headerlink" href="#create-vertical-grid" title="Permalink to this heading">#</a></h3>
<section id="vertical-grid-levels-defined-at-the-cell-faces">
<h4>160 vertical grid levels, defined at the cell faces<a class="headerlink" href="#vertical-grid-levels-defined-at-the-cell-faces" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nz</span> <span class="o">=</span> <span class="mi">160</span>

<span class="n">dz_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nz</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dz_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">20.0</span>
<span class="n">dz_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">25.0</span>
<span class="n">dz_grid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">30.0</span>
<span class="n">dz_grid</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">35.0</span>
<span class="n">dz_grid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">140</span><span class="p">]</span> <span class="o">=</span> <span class="mf">40.0</span>
<span class="n">dz_grid</span><span class="p">[</span><span class="mi">140</span><span class="p">]</span> <span class="o">=</span> <span class="mf">60.0</span>
<span class="n">dz_grid</span><span class="p">[</span><span class="mi">141</span><span class="p">:</span><span class="mi">157</span><span class="p">]</span> <span class="o">=</span> <span class="mf">80.0</span>
<span class="n">dz_grid</span><span class="p">[</span><span class="mi">157</span><span class="p">]</span> <span class="o">=</span> <span class="mf">60.0</span>
<span class="n">dz_grid</span><span class="p">[</span><span class="mi">158</span><span class="p">]</span> <span class="o">=</span> <span class="mf">50.0</span>

<span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
<span class="n">z_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)):</span>
    <span class="n">z_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_grid</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dz_grid</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="read-in-data-from-era5-backtrajectory-netcdf">
<h3>Read in data from ERA5 backtrajectory (netCDF)<a class="headerlink" href="#read-in-data-from-era5-backtrajectory-netcdf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open met dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">fname_era5_met</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

<span class="c1"># Read variables (1D arrays are time, 2D arrays are time x pressure level)</span>
<span class="n">hours</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">][:]</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">][:]</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">][:]</span>
<span class="n">pres</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Pressure&#39;</span><span class="p">][:]</span>
<span class="n">sfc_pres</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;SfcPres&#39;</span><span class="p">][:]</span>
<span class="n">sst</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;SST&#39;</span><span class="p">][:]</span>
<span class="n">hgt</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;GEOS_HT&#39;</span><span class="p">][:,:]</span>
<span class="n">uwnd</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">][:,:]</span>
<span class="n">vwnd</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">][:,:]</span>
<span class="n">wwnd</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">][:,:]</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Temp&#39;</span><span class="p">][:,:]</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Theta&#39;</span><span class="p">][:,:]</span>
<span class="n">qv</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;SH&#39;</span><span class="p">][:,:]</span>

<span class="c1"># Open ozone dataset</span>
<span class="n">dataset_o3</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">fname_era5_o3</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

<span class="c1"># Read variables</span>
<span class="n">o3</span> <span class="o">=</span> <span class="n">dataset_o3</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;O3&#39;</span><span class="p">][:,:]</span>
<span class="n">pres_o3</span> <span class="o">=</span> <span class="n">dataset_o3</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Pressure&#39;</span><span class="p">][:]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-units">
<h3>Convert units<a class="headerlink" href="#convert-units" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sfc_pres_pa</span> <span class="o">=</span> <span class="n">sfc_pres</span><span class="o">/</span><span class="mf">100.</span>  <span class="c1"># Pa to hPa</span>
<span class="n">pres_pa</span> <span class="o">=</span> <span class="n">pres</span><span class="o">*</span><span class="mf">100.</span>          <span class="c1"># hPa to Pa</span>
<span class="n">pres_o3_pa</span> <span class="o">=</span> <span class="n">pres_o3</span><span class="o">*</span><span class="mf">100.</span>    <span class="c1"># hPa to Pa</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reverse-time-dimension-of-2d-arrays-as-well-as-sfc-pressure-and-sst-so-that-beginning-of-backward-trajectory-is-in-first-position">
<h3>Reverse time dimension of 2D arrays, as well as sfc pressure and sst, so that beginning of backward trajectory is in first position<a class="headerlink" href="#reverse-time-dimension-of-2d-arrays-as-well-as-sfc-pressure-and-sst-so-that-beginning-of-backward-trajectory-is-in-first-position" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">hgt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">uwnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">uwnd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">vwnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">vwnd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">wwnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">wwnd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">qv</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">o3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">o3</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sfc_pres_pa</span> <span class="o">=</span> <span class="n">sfc_pres_pa</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sst</span> <span class="o">=</span> <span class="n">sst</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="unmask-sst-field-and-get-index-according-to-t0-h-furthest-north-we-can-go-is-28h-after-backtrajectory-initialization-from-andenes-or-3-12-20-at-14-utc">
<h3>Unmask sst field and get index according to t0_h (furthest north we can go is 28h after backtrajectory initialization from Andenes, or 3/12/20 at 14 UTC)<a class="headerlink" href="#unmask-sst-field-and-get-index-according-to-t0-h-furthest-north-we-can-go-is-28h-after-backtrajectory-initialization-from-andenes-or-3-12-20-at-14-utc" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sst_real</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">sst</span><span class="p">)</span>
<span class="n">loopidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sst_real</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">loopidx</span><span class="p">[</span><span class="mi">10</span><span class="o">-</span><span class="n">t0_h</span><span class="p">]</span>
<span class="n">t0_init_th_qv</span> <span class="o">=</span> <span class="n">loopidx</span><span class="p">[</span><span class="mi">10</span><span class="o">-</span><span class="n">t0_h_init_th_qv</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-sfc-potential-temperature">
<h3>Calculate sfc potential temperature<a class="headerlink" href="#calculate-sfc-potential-temperature" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta1000mb</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">sfc_theta</span> <span class="o">=</span> <span class="n">theta1000mb</span><span class="o">*</span><span class="nb">pow</span><span class="p">((</span><span class="mf">1000.</span><span class="o">/</span><span class="n">sfc_pres_pa</span><span class="p">),</span><span class="mf">0.286</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-information-at-t0">
<h3>Get information at t0<a class="headerlink" href="#get-information-at-t0" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z1</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">pres_t0</span> <span class="o">=</span> <span class="n">pres_pa</span><span class="p">[</span><span class="n">z1</span><span class="p">:]</span>
<span class="n">pres_o3_t0</span> <span class="o">=</span> <span class="n">pres_o3_pa</span><span class="p">[</span><span class="n">z1</span><span class="p">:]</span>
<span class="n">hgt_t0</span> <span class="o">=</span> <span class="n">hgt</span><span class="p">[</span><span class="n">t0_init_th_qv</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>
<span class="n">uwnd_t0</span> <span class="o">=</span> <span class="n">uwnd</span><span class="p">[</span><span class="n">t0</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>
<span class="n">vwnd_t0</span> <span class="o">=</span> <span class="n">vwnd</span><span class="p">[</span><span class="n">t0</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>
<span class="n">wwnd_t0</span> <span class="o">=</span> <span class="n">wwnd</span><span class="p">[</span><span class="n">t0</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>
<span class="n">temp_t0</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">t0_init_th_qv</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>
<span class="n">theta_t0</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="n">t0_init_th_qv</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>
<span class="n">qv_t0</span> <span class="o">=</span> <span class="n">qv</span><span class="p">[</span><span class="n">t0_init_th_qv</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>

<span class="c1"># temporal avg for o3</span>
<span class="n">o3_t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">o3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="o">+</span><span class="n">t0_h</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">z1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ps_t0</span> <span class="o">=</span> <span class="n">sfc_pres_pa</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span>
<span class="n">thetas_t0</span> <span class="o">=</span> <span class="n">sfc_theta</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="extrapolate-o3-since-era5-only-goes-to-1-hpa-and-plot-versus-original-profile">
<h3>Extrapolate O3 since ERA5 only goes to 1 hPa and plot versus original profile<a class="headerlink" href="#extrapolate-o3-since-era5-only-goes-to-1-hpa-and-plot-versus-original-profile" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add top pressure and o3 value - here we assume o3 goes to zero at 1e-4 Pa</span>
<span class="n">pres_o3_t0_add_top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pres_o3_t0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_o3_t0</span><span class="p">),</span><span class="mf">0.0001</span><span class="p">)</span>
<span class="n">o3_t0_add_top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">o3_t0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">o3_t0</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># Add bottom pressure and o3 value - here we assume o3 is constant near the sfc</span>
<span class="n">pres_o3_t0_add_top_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pres_o3_t0_add_top</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">pres_t0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">o3_t0_add_top_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">o3_t0_add_top</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">o3_t0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Do the extrapolation</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">pres_o3_t0_add_top_bottom</span><span class="p">,</span> <span class="n">o3_t0_add_top_bottom</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
<span class="n">o3_t0i</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">pres_t0</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">var_plt1</span> <span class="o">=</span> <span class="n">o3_t0</span>
<span class="n">var_plt2</span> <span class="o">=</span> <span class="n">o3_t0i</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt1</span><span class="p">,</span><span class="n">pres_o3_t0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original profile&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt2</span><span class="p">,</span><span class="n">pres_t0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Extrapolated profile&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ozone (kg kg-1)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure (Pa)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../_images/8c9f6146fede7f3591789241cfef3f1b2008204fbccb20a1eca1735df1834290.png" src="../../_images/8c9f6146fede7f3591789241cfef3f1b2008204fbccb20a1eca1735df1834290.png" />
</div>
</div>
</section>
<section id="get-geostrophic-wind-forcing">
<h3>Get Geostrophic wind forcing<a class="headerlink" href="#get-geostrophic-wind-forcing" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="c1"># Read ERA5 file</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">fname_era5_geo</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

    <span class="n">zl</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="mi">24</span><span class="o">-</span><span class="n">t0_h</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="c1"># time, lev, lat, lon</span>
    <span class="n">lonarrl</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][:]</span>
    <span class="n">latarrl</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][:]</span>

    <span class="n">latloc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="n">lonloc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="n">ugl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">zl</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">vgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">zl</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">zhtl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">zl</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">)):</span>
        <span class="n">hold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">latarrl</span><span class="p">)</span>
        <span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">hold</span><span class="p">)</span>
        <span class="n">hold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">les_lon2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">lonarrl</span><span class="p">)</span>   
        <span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">hold</span><span class="p">)</span>

        <span class="c1"># Coriolis parameter</span>
        <span class="n">e</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="c1"># Calc dx, dy</span>
        <span class="n">offset1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">offset2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">coords_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">latarrl</span><span class="p">[</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">lonarrl</span><span class="p">[</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">offset2</span><span class="p">])</span>
        <span class="n">coords_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">latarrl</span><span class="p">[</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">lonarrl</span><span class="p">[</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">offset2</span><span class="p">])</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">geopy</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">coords_1</span><span class="p">,</span> <span class="n">coords_2</span><span class="p">)</span><span class="o">.</span><span class="n">km</span>
        <span class="n">coords_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">latarrl</span><span class="p">[</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">offset1</span><span class="p">],</span> <span class="n">lonarrl</span><span class="p">[</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">coords_4</span> <span class="o">=</span> <span class="p">(</span><span class="n">latarrl</span><span class="p">[</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">offset1</span><span class="p">],</span> <span class="n">lonarrl</span><span class="p">[</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">geopy</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">coords_3</span><span class="p">,</span> <span class="n">coords_4</span><span class="p">)</span><span class="o">.</span><span class="n">km</span>
        <span class="k">while</span> <span class="n">dx</span> <span class="o">&lt;</span> <span class="n">min_dx</span><span class="p">:</span> <span class="c1"># we want at least min_dx km for our zonal discretization, which changes with time (latitude)</span>
            <span class="n">offset2</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">coords_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">latarrl</span><span class="p">[</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">lonarrl</span><span class="p">[</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">offset2</span><span class="p">])</span>
            <span class="n">coords_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">latarrl</span><span class="p">[</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">lonarrl</span><span class="p">[</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">offset2</span><span class="p">])</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">geopy</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">coords_1</span><span class="p">,</span> <span class="n">coords_2</span><span class="p">)</span><span class="o">.</span><span class="n">km</span>
        <span class="k">while</span> <span class="n">dy</span> <span class="o">&lt;</span> <span class="n">min_dy</span><span class="p">:</span> <span class="c1"># we want at least min_dy km for our meridional discretization, which stays mostly constant with time (latitude)</span>
            <span class="n">offset1</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">coords_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">latarrl</span><span class="p">[</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">offset1</span><span class="p">],</span> <span class="n">lonarrl</span><span class="p">[</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">coords_4</span> <span class="o">=</span> <span class="p">(</span><span class="n">latarrl</span><span class="p">[</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">offset1</span><span class="p">],</span> <span class="n">lonarrl</span><span class="p">[</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">geopy</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">coords_3</span><span class="p">,</span> <span class="n">coords_4</span><span class="p">)</span><span class="o">.</span><span class="n">km</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="mf">1000.</span> <span class="c1"># km to m</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">dy</span><span class="o">*</span><span class="mf">1000.</span>

        <span class="c1"># Calc Vg</span>
        <span class="n">ugl</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">zl</span><span class="p">[</span><span class="n">i</span><span class="p">,:,</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">offset1</span><span class="p">,</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">-</span><span class="n">zl</span><span class="p">[</span><span class="n">i</span><span class="p">,:,</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">offset1</span><span class="p">,</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">/</span><span class="n">dy</span>
        <span class="n">vgl</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">f</span><span class="p">)</span>  <span class="o">*</span> <span class="p">(</span><span class="n">zl</span><span class="p">[</span><span class="n">i</span><span class="p">,:,</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">offset2</span><span class="p">]</span><span class="o">-</span><span class="n">zl</span><span class="p">[</span><span class="n">i</span><span class="p">,:,</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">offset2</span><span class="p">])</span><span class="o">/</span><span class="n">dx</span>
        <span class="n">zhtl</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">zl</span><span class="p">[</span><span class="n">i</span><span class="p">,:,</span><span class="n">latloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">lonloc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">/</span><span class="n">g</span>

    <span class="n">ugeo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ugl</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">vgeo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">vgl</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">zgeo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">zhtl</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ugeo</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">ugeo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">vgeo</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">vgeo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Geostrophic wind computed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Geostrophic wind computed
</pre></div>
</div>
</div>
</div>
</section>
<section id="interpolate-extrapolate-ug-vg-to-native-era5-levels">
<h3>Interpolate/extrapolate Ug/Vg to native ERA5 levels<a class="headerlink" href="#interpolate-extrapolate-ug-vg-to-native-era5-levels" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="n">ugeo_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ugeo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">hgt</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">vgeo_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ugeo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">hgt</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">zgeo_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ugeo</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">hgt</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">les_lat2</span><span class="p">)):</span>
        <span class="n">zgeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">zgeo</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">ugeo</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="n">ugeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">zgeo</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">vgeo</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="n">vgeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="interpolate-t0-profiles-nudging-profiles-and-geostrophic-wind-profiles-to-common-vertical-grid-for-simplicity">
<h3>Interpolate t0 profiles, nudging profiles, and geostrophic wind profiles to common vertical grid for simplicity<a class="headerlink" href="#interpolate-t0-profiles-nudging-profiles-and-geostrophic-wind-profiles-to-common-vertical-grid-for-simplicity" title="Permalink to this heading">#</a></h3>
<section id="find-time-with-highest-first-level-and-get-vertical-grid">
<h4>Find time with highest first level and get vertical grid<a class="headerlink" href="#find-time-with-highest-first-level-and-get-vertical-grid" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="n">zz1_geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)])</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
        <span class="n">zz1_geo</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">zgeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>

    <span class="n">zz1_nudge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)])</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
        <span class="n">zz1_nudge</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>

        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>

    <span class="n">zz1_geo_max_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">zz1_geo</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">zz1_nudge_max_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">zz1_nudge</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">zz1_geo_max</span> <span class="o">=</span> <span class="n">zz1_geo</span><span class="p">[</span><span class="n">zz1_geo_max_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">zz1_nudge_max</span> <span class="o">=</span> <span class="n">zz1_nudge</span><span class="p">[</span><span class="n">zz1_nudge_max_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">zz1_geo_max</span> <span class="o">&gt;</span> <span class="n">zz1_nudge_max</span><span class="p">:</span>
        <span class="n">zgeoi</span> <span class="o">=</span> <span class="n">zz1_geo</span><span class="p">[</span><span class="n">zz1_geo_max_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zgeoi</span> <span class="o">=</span> <span class="n">zz1_nudge</span><span class="p">[</span><span class="n">zz1_nudge_max_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
<span class="k">else</span><span class="p">:</span>
    <span class="n">zz1_nudge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)])</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
        <span class="n">zz1_nudge</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:]</span>

        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>

    <span class="n">zz1_nudge_max_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">zz1_nudge</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">zz1_nudge_max</span> <span class="o">=</span> <span class="n">zz1_nudge</span><span class="p">[</span><span class="n">zz1_nudge_max_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">zgeoi</span> <span class="o">=</span> <span class="n">zz1_nudge</span><span class="p">[</span><span class="n">zz1_nudge_max_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;First level for all profiles = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; m&#39;</span> <span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First level for all profiles = 18.168 m
[1.81678200e+01 3.78291588e+01 5.93531876e+01 8.29409561e+01
 1.08634644e+02 1.36762817e+02 1.67474060e+02 2.01006256e+02
 2.37572968e+02 2.77470947e+02 3.20925720e+02 3.68243713e+02
 4.19705322e+02 4.75707489e+02 5.36504822e+02 6.02413635e+02
 6.73863464e+02 7.51188721e+02 8.34781677e+02 9.25015015e+02
 1.02229761e+03 1.12704102e+03 1.23956067e+03 1.36028394e+03
 1.48945679e+03 1.62738745e+03 1.77428064e+03 1.93038416e+03
 2.09574048e+03 2.27039331e+03 2.45438965e+03 2.64754395e+03
 2.84974072e+03 3.06066577e+03 3.27992432e+03 3.50704077e+03
 3.74134668e+03 3.98210889e+03 4.22867920e+03 4.48078857e+03
 4.73797949e+03 4.99874365e+03 5.26092578e+03 5.52306201e+03
 5.78483252e+03 6.04644922e+03 6.30803760e+03 6.56951123e+03
 6.83091602e+03 7.09283643e+03 7.35596924e+03 7.62092139e+03
 7.88798877e+03 8.15741553e+03 8.42925000e+03 8.70381738e+03
 8.98155176e+03 9.26270898e+03 9.54723730e+03 9.83502930e+03
 1.01259678e+04 1.04200625e+04 1.07173477e+04 1.10177529e+04
 1.13212578e+04 1.16278047e+04 1.19373662e+04 1.22498711e+04
 1.25653350e+04 1.28839326e+04 1.32058555e+04 1.35312275e+04
 1.38601523e+04 1.41925664e+04 1.45284150e+04 1.48675010e+04
 1.52095967e+04 1.55542930e+04 1.59013115e+04 1.62505469e+04
 1.66022949e+04 1.69575215e+04 1.73173887e+04 1.76829043e+04
 1.80547246e+04 1.84334707e+04 1.88199785e+04 1.92153418e+04
 1.96205273e+04 2.00361152e+04 2.04623945e+04 2.09000508e+04
 2.13498691e+04 2.18124043e+04 2.22871719e+04 2.27734141e+04
 2.32704062e+04 2.37781934e+04 2.42975605e+04 2.48301953e+04
 2.53780762e+04 2.59425137e+04 2.65239766e+04 2.71227988e+04
 2.77392344e+04 2.83741738e+04 2.90299805e+04 2.97107168e+04
 3.04193066e+04 3.11562773e+04 3.19218848e+04 3.27171895e+04
 3.35436523e+04 3.44022461e+04 3.52931797e+04 3.62169961e+04
 3.71792188e+04 3.82055078e+04 3.93279570e+04 4.05411719e+04
 4.18197422e+04 4.31656016e+04 4.45927344e+04 4.61026953e+04
 4.76934102e+04 4.93620195e+04 5.11093516e+04 5.29429336e+04
 5.48647773e+04 5.68720195e+04 5.89728828e+04 6.11852734e+04
 6.35144883e+04 6.59572734e+04 6.85121250e+04 7.11708984e+04]
</pre></div>
</div>
</div>
</div>
</section>
<section id="do-the-linear-interpolation-of-time-varying-geostrophic-profiles-to-new-vertical-grid">
<h4>Do the linear interpolation of time-varying geostrophic profiles to new vertical grid<a class="headerlink" href="#do-the-linear-interpolation-of-time-varying-geostrophic-profiles-to-new-vertical-grid" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="n">ugeoi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">vgeoi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">zgeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">ugeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
        <span class="n">ugeoi</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">zgeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">vgeo_new</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
        <span class="n">vgeoi</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>

        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-original-and-interpolated-profiles-of-time-varying-geostrophic-wind-as-example-to-show-efficacy-of-method">
<h4>Compare original and interpolated profiles of time-varying geostrophic wind as example to show efficacy of method<a class="headerlink" href="#compare-original-and-interpolated-profiles-of-time-varying-geostrophic-wind-as-example-to-show-efficacy-of-method" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zplt1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">zplt2</span> <span class="o">=</span> <span class="n">nhrs</span><span class="o">-</span><span class="mi">3</span>
<span class="n">zplt2b</span> <span class="o">=</span> <span class="mi">50</span>

<span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

    <span class="n">var_plt1</span> <span class="o">=</span> <span class="n">ugeo</span>
    <span class="n">var_plt2</span> <span class="o">=</span> <span class="n">ugeoi</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">zgeo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;U$_</span><span class="si">{g}</span><span class="s1">$-wind (m s-1)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Height ASL (m)&#39;</span><span class="p">)</span>

    <span class="n">var_plt1</span> <span class="o">=</span> <span class="n">vgeo</span>
    <span class="n">var_plt2</span> <span class="o">=</span> <span class="n">vgeoi</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">zgeo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original profile&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Interpolated profile&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">zgeo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;V$_</span><span class="si">{g}</span><span class="s1">$-wind (m s-1)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../_images/0369d3606b317f2ce5dd1dc3360376bb452b3d2fe22f634d45ef446ce6dbbdce.png" src="../../_images/0369d3606b317f2ce5dd1dc3360376bb452b3d2fe22f634d45ef446ce6dbbdce.png" />
</div>
</div>
</section>
<section id="do-the-linear-interpolation-for-initial-forcing-profiles">
<h4>Do the linear interpolation for initial forcing profiles<a class="headerlink" href="#do-the-linear-interpolation-for-initial-forcing-profiles" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt_t0</span><span class="p">,</span> <span class="n">pres_t0</span><span class="p">)</span>
<span class="n">pres_t0i</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt_t0</span><span class="p">,</span> <span class="n">uwnd_t0</span><span class="p">)</span>
<span class="n">uwnd_t0i</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt_t0</span><span class="p">,</span> <span class="n">vwnd_t0</span><span class="p">)</span>
<span class="n">vwnd_t0i</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt_t0</span><span class="p">,</span> <span class="n">wwnd_t0</span><span class="p">)</span>
<span class="n">wwnd_t0i</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt_t0</span><span class="p">,</span> <span class="n">temp_t0</span><span class="p">)</span>
<span class="n">temp_t0i</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt_t0</span><span class="p">,</span> <span class="n">theta_t0</span><span class="p">)</span>
<span class="n">theta_t0i</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt_t0</span><span class="p">,</span> <span class="n">qv_t0</span><span class="p">)</span>
<span class="n">qv_t0i</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt_t0</span><span class="p">,</span> <span class="n">o3_t0i</span><span class="p">)</span>
<span class="n">o3_t0i</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="do-the-linear-interpolation-for-nudging-forcing-profiles">
<h4>Do the linear interpolation for nudging forcing profiles<a class="headerlink" href="#do-the-linear-interpolation-for-nudging-forcing-profiles" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">do_u_v_nudge</span><span class="p">:</span>
    <span class="n">unudgei</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">vnudgei</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">if</span> <span class="n">do_th_qv_nudge</span><span class="p">:</span>
    <span class="n">tnudgei</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">qvnudgei</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">if</span> <span class="n">do_subsidence</span><span class="p">:</span>
    <span class="n">wnudgei</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">nhrs</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pres_t0</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">if</span> <span class="n">do_u_v_nudge</span> <span class="ow">or</span> <span class="n">do_th_qv_nudge</span> <span class="ow">or</span> <span class="n">do_subsidence</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">do_u_v_nudge</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:],</span> <span class="n">uwnd</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:])</span>
            <span class="n">unudgei</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:],</span> <span class="n">vwnd</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:])</span>
            <span class="n">vnudgei</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">do_th_qv_nudge</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:],</span> <span class="n">theta</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:])</span>
            <span class="n">tnudgei</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:],</span> <span class="n">qv</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:])</span>
            <span class="n">qvnudgei</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_subsidence</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:],</span> <span class="n">wwnd</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">z1</span><span class="p">:])</span>
            <span class="n">wnudgei</span><span class="p">[</span><span class="n">count</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">)</span>

        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-original-and-interpolated-profiles-of-time-varying-nudging-wind-as-example-to-show-efficacy-of-method">
<h4>Compare original and interpolated profiles of time-varying nudging wind as example to show efficacy of method<a class="headerlink" href="#compare-original-and-interpolated-profiles-of-time-varying-nudging-wind-as-example-to-show-efficacy-of-method" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zplt1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">zplt2</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">zplt2b</span> <span class="o">=</span> <span class="mi">50</span>

<span class="k">if</span> <span class="n">do_geo</span> <span class="ow">and</span> <span class="n">do_u_v_nudge</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

    <span class="n">var_plt1</span> <span class="o">=</span> <span class="n">uwnd</span>
    <span class="n">var_plt2</span> <span class="o">=</span> <span class="n">unudgei</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt1</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;U-wind (m s-1)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Height ASL (m)&#39;</span><span class="p">)</span>

    <span class="n">var_plt1</span> <span class="o">=</span> <span class="n">vwnd</span>
    <span class="n">var_plt2</span> <span class="o">=</span> <span class="n">vnudgei</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt1</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original profile&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Interpolated profile&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt1</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">hgt</span><span class="p">[</span><span class="n">t0</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_plt2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">zplt1</span><span class="p">:</span><span class="n">zplt2b</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;V-wind (m s-1)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c488e36bbeda0f7500e225a070e6d8d4779a9934951ed5bf0358c9dc0bc95fc5.png" src="../../_images/c488e36bbeda0f7500e225a070e6d8d4779a9934951ed5bf0358c9dc0bc95fc5.png" />
</div>
</div>
</section>
<section id="shift-profiles-downward-according-to-anns-method">
<h4>Shift profiles downward according to Annâ€™s method<a class="headerlink" href="#shift-profiles-downward-according-to-anns-method" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adjusted height</span>
<span class="n">zgeoi_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zgeoi</span><span class="p">))</span>
<span class="n">zgeoi_shift</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">zgeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">zmid_idx</span> <span class="o">=</span> <span class="mi">17</span> <span class="c1"># ~middle of inversion</span>
<span class="n">zgeoi_shift</span><span class="p">[</span><span class="n">zmid_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">zgeoi</span><span class="p">[</span><span class="n">zmid_idx</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">zstop_idx</span> <span class="o">=</span> <span class="mi">33</span>
<span class="n">zstop</span> <span class="o">=</span> <span class="mf">3000.</span> <span class="c1"># m, where we want to stop loop</span>

<span class="n">zgeoi_shift</span><span class="p">[</span><span class="n">zstop_idx</span><span class="p">:]</span> <span class="o">=</span> <span class="n">zgeoi</span><span class="p">[</span><span class="n">zstop_idx</span><span class="p">:]</span>

<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">zgeoi</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">zstop</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">zmid_idx</span><span class="p">:</span>
        <span class="n">zgeoi_shift</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">zgeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">-</span> <span class="n">zgeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">zmid_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">zgeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="n">zgeoi_shift</span><span class="p">[</span><span class="n">zmid_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">zgeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">zmid_idx</span><span class="p">:</span>
        <span class="n">zgeoi_shift</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">zgeoi_shift</span><span class="p">[</span><span class="n">zmid_idx</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">-</span> <span class="n">zgeoi</span><span class="p">[</span><span class="n">zmid_idx</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">zgeoi</span><span class="p">[</span><span class="n">zstop_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">zgeoi</span><span class="p">[</span><span class="n">zmid_idx</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">zgeoi_shift</span><span class="p">[</span><span class="n">zstop_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">zgeoi_shift</span><span class="p">[</span><span class="n">zmid_idx</span><span class="p">])</span>
    <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_t0i</span><span class="p">,</span><span class="n">zgeoi</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_t0i</span><span class="p">,</span><span class="n">zgeoi_shift</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Shift&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3500</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">245</span><span class="p">,</span><span class="mi">280</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x2b98a5a01940&gt;
</pre></div>
</div>
<img alt="../../_images/e885c024d545a2fedac9224a904b6cfb0cac6c91d1875be982c6d12dbdf339e6.png" src="../../_images/e885c024d545a2fedac9224a904b6cfb0cac6c91d1875be982c6d12dbdf339e6.png" />
</div>
</div>
</section>
</section>
<section id="smooth-shifted-initial-water-vapor-mixing-ratio-profile">
<h3>Smooth shifted initial water vapor mixing ratio profile<a class="headerlink" href="#smooth-shifted-initial-water-vapor-mixing-ratio-profile" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qv_t0i_mod</span> <span class="o">=</span> <span class="n">qv_t0i</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">qv_t0i_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.27e-3</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qv_t0i</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">zgeoi</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qv_t0i</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">zgeoi_shift</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Shift&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qv_t0i_mod</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">zgeoi_shift</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Shift+Smooth&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3500</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x2b98a5d5f080&gt;
</pre></div>
</div>
<img alt="../../_images/918bf0175e1a4f01cfce61a826a4261faaca0b6e8816f8d0436082a8316243c4.png" src="../../_images/918bf0175e1a4f01cfce61a826a4261faaca0b6e8816f8d0436082a8316243c4.png" />
</div>
</div>
</section>
<section id="using-1d-model-from-gunilla-svensson-approximate-deviation-from-geostrophy-and-add-offset-to-initial-geostrophic-winds-for-our-initial-wind-profile">
<h3>Using 1D model from Gunilla Svensson, approximate deviation from geostrophy and add offset to initial geostrophic winds for our initial wind profile<a class="headerlink" href="#using-1d-model-from-gunilla-svensson-approximate-deviation-from-geostrophy-and-add-offset-to-initial-geostrophic-winds-for-our-initial-wind-profile" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="n">gunilla_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">profiles_1d_model</span><span class="p">)</span>
    <span class="n">gunilla_u</span> <span class="o">=</span> <span class="n">gunilla_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
    <span class="n">gunilla_v</span> <span class="o">=</span> <span class="n">gunilla_data</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="n">gunilla_th</span> <span class="o">=</span> <span class="n">gunilla_data</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span>
    <span class="n">gunilla_z</span> <span class="o">=</span> <span class="n">gunilla_data</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span>

    <span class="c1"># express the winds as offsets from geostrophic</span>
    <span class="n">gunilla_du</span> <span class="o">=</span> <span class="n">gunilla_u</span> <span class="o">-</span> <span class="n">gunilla_u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">gunilla_dv</span> <span class="o">=</span> <span class="n">gunilla_v</span> <span class="o">-</span> <span class="n">gunilla_v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># add offsets to the initial profile</span>
    <span class="n">du</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">zgeoi_shift</span><span class="p">,</span><span class="n">gunilla_z</span><span class="p">,</span><span class="n">gunilla_du</span><span class="p">)</span>
    <span class="n">dv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">zgeoi_shift</span><span class="p">,</span><span class="n">gunilla_z</span><span class="p">,</span><span class="n">gunilla_dv</span><span class="p">)</span>
    <span class="n">ugeoi_t0i_mod</span> <span class="o">=</span> <span class="n">ugeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">du</span>
    <span class="n">vgeoi_t0i_mod</span> <span class="o">=</span> <span class="n">vgeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">dv</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ugeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">zgeoi_shift</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original U$_</span><span class="si">{g}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vgeoi</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">zgeoi_shift</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original V$_</span><span class="si">{g}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ugeoi_t0i_mod</span><span class="p">,</span><span class="n">zgeoi_shift</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Modified U$_</span><span class="si">{g}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vgeoi_t0i_mod</span><span class="p">,</span><span class="n">zgeoi_shift</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Modified V$_</span><span class="si">{g}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f51e5041f3748f6b5ce6b00521b87325613578ec3d29babdbb0277ff6037de7c.png" src="../../_images/f51e5041f3748f6b5ce6b00521b87325613578ec3d29babdbb0277ff6037de7c.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="do-sfc-forcing">
<h1>DO SFC FORCING<a class="headerlink" href="#do-sfc-forcing" title="Permalink to this heading">#</a></h1>
<section id="calculate-sea-ice-concentration-along-trajectory">
<h2>Calculate sea ice concentration along trajectory<a class="headerlink" href="#calculate-sea-ice-concentration-along-trajectory" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sic_file</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">fname_sic</span><span class="p">)</span>
<span class="n">sic</span> <span class="o">=</span> <span class="n">sic_file</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][:,:]</span>
<span class="n">sic_lat</span> <span class="o">=</span> <span class="n">sic_file</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
<span class="n">sic_lon</span> <span class="o">=</span> <span class="n">sic_file</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>

<span class="n">sic_traj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">les_hh_idx</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">les_hh_idx</span><span class="p">)):</span>
    <span class="n">abslat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sic_lat</span><span class="o">-</span><span class="n">les_lat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">abslon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sic_lon</span><span class="o">-</span><span class="n">les_lon</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">jlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">abslat</span><span class="p">)</span>
    <span class="n">ilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">abslon</span><span class="p">)</span>
    <span class="n">sic_traj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sic</span><span class="p">[</span><span class="n">jlat</span><span class="p">,</span><span class="n">ilon</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-time-series-information-for-sfc-forcing">
<h2>Get time series information for sfc forcing<a class="headerlink" href="#get-time-series-information-for-sfc-forcing" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print statements?</span>
<span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Pack ice skin temperature</span>
<span class="n">tsk_ice</span> <span class="o">=</span> <span class="mf">247.0</span>

<span class="c1"># Interpolate SST</span>
<span class="n">tmp_hh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">t0_h</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># these are the hours we have SST data from the ERA5 backward trajectory file</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tmp_hh</span><span class="p">,</span> <span class="n">sst</span><span class="p">[</span><span class="n">t0</span><span class="p">:])</span>
<span class="n">sst_interp</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">les_hh</span><span class="p">[</span><span class="n">les_hh_idx</span><span class="p">])</span>

<span class="c1"># Modification for over ice/MIZ</span>
<span class="n">sst_ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sic_traj</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sic_traj</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">sic_traj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">90.0</span><span class="p">:</span> <span class="c1"># over ice</span>
        <span class="n">sst_ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsk_ice</span>
    <span class="k">elif</span> <span class="n">sic_traj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span> <span class="c1"># MIZ</span>
        <span class="n">sst_ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sic_traj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="n">tsk_ice</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="p">(</span><span class="n">sic_traj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span><span class="p">))</span><span class="o">*</span><span class="n">sst_interp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># MIZ</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># open ocean</span>
        <span class="n">sst_ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sst_interp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Computed TSK for hour &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="mf">60.</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span>
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sst_ts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; with SIC = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sic_traj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span> <span class="o">+</span>
               <span class="s1">&#39; and SST = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sst_interp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)))</span>

<span class="c1"># Pull hourly SST</span>
<span class="n">sst_ts</span> <span class="o">=</span> <span class="n">sst_ts</span><span class="p">[::</span><span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-new-netcdf-file">
<h2>Create new netcdf file<a class="headerlink" href="#create-new-netcdf-file" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># just to be safe, make sure dataset is not already open.</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
<span class="n">ncfile</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">save_name</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF3_CLASSIC&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-dimensions">
<h2>Create dimensions<a class="headerlink" href="#create-dimensions" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">levs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zgeoi_shift</span><span class="p">)</span>
<span class="n">z_grid_levs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)</span>
<span class="n">t0_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>     <span class="c1"># initial time axis</span>
<span class="n">lat_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>     <span class="c1"># latitude axis</span>
<span class="n">lon_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>     <span class="c1"># longitude axis</span>
<span class="n">lev_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span> <span class="n">levs</span><span class="p">)</span>      <span class="c1"># level axis</span>
<span class="n">zw_grid_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;zw_grid&#39;</span><span class="p">,</span> <span class="n">z_grid_levs</span><span class="p">)</span>      <span class="c1"># zw_grid axis</span>
<span class="n">time_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>    <span class="c1"># unlimited axis (can be appended to)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-global-attributes">
<h2>Create global attributes<a class="headerlink" href="#create-global-attributes" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ncfile</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Forcing and initial conditions for 13 March 2020 COMBLE intercomparison case&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">reference</span><span class="o">=</span><span class="s1">&#39;https://arm-development.github.io/comble-mip/&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">authors</span><span class="o">=</span><span class="s1">&#39;Timothy W. Juliano (NCAR/RAL, tjuliano@ucar.edu); Florian Tornow (NASA/GISS, ft2544@columbia.edu); Ann M. Fridlind (NASA/GISS, ann.fridlind@nasa.gov)&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;Created on &#39;</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">format_version</span><span class="o">=</span><span class="s1">&#39;DEPHY SCM format version 2.0&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">script</span><span class="o">=</span><span class="n">script_name</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="s1">&#39;Simulations beginning prior to the ice edge set z0=0.001 m over ice then compute z0 using Charnock.&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">startDate</span><span class="o">=</span><span class="n">start_time</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">endDate</span><span class="o">=</span><span class="s1">&#39;2020-03-13 18:00:00&#39;</span>
<span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="n">ncfile</span><span class="o">.</span><span class="n">forc_geo</span><span class="o">=</span><span class="mi">1</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ncfile</span><span class="o">.</span><span class="n">forc_geo</span><span class="o">=</span><span class="mi">0</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">radiation</span><span class="o">=</span><span class="s1">&#39;on&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">forc_wap</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">forc_wa</span><span class="o">=</span><span class="mi">0</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">surface_type</span><span class="o">=</span><span class="s1">&#39;landice-ocean&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">surface_forcing_temp</span><span class="o">=</span><span class="s1">&#39;ts&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">surface_forcing_moisture</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">surface_forcing_wind</span><span class="o">=</span><span class="s1">&#39;z0-none&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">lat</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">les_lat_mid</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; deg N&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">dx</span><span class="o">=</span><span class="s1">&#39;150 m&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">dy</span><span class="o">=</span><span class="s1">&#39;150 m&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">dz</span><span class="o">=</span><span class="s1">&#39;see zw_grid variable&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">nx</span><span class="o">=</span><span class="s1">&#39;648&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">ny</span><span class="o">=</span><span class="s1">&#39;648&#39;</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">nz</span><span class="o">=</span><span class="s1">&#39;160&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-variables">
<h2>Create variables<a class="headerlink" href="#create-variables" title="Permalink to this heading">#</a></h2>
<section id="dimensions">
<h3>Dimensions<a class="headerlink" href="#dimensions" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t0_time</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,))</span>
<span class="n">t0_time</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;seconds since &#39;</span> <span class="o">+</span> <span class="n">start_time</span>
<span class="n">t0_time</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;Initial time&#39;</span>

<span class="n">latitude</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,))</span>
<span class="n">latitude</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_north&#39;</span>
<span class="n">latitude</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span>

<span class="n">longitude</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">longitude</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_east&#39;</span>
<span class="n">longitude</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
<span class="n">time</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;seconds since &#39;</span> <span class="o">+</span> <span class="n">start_time</span>
<span class="n">time</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>

<span class="n">lev</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
<span class="n">lev</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
<span class="n">lev</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;altitude&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="initial-profiles">
<h3>Initial profiles<a class="headerlink" href="#initial-profiles" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pressure</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">pressure</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Pa&#39;</span>
<span class="n">pressure</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;pressure&#39;</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">u</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m s-1&#39;</span>
<span class="n">u</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;zonal wind&#39;</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m s-1&#39;</span>
<span class="n">v</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;meridional wind&#39;</span>

<span class="n">temperature</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">temperature</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
<span class="n">temperature</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;temperature&#39;</span>

<span class="n">ptemperature</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">ptemperature</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
<span class="n">ptemperature</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;potential temperature&#39;</span>

<span class="n">qvapor</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;qv&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">qvapor</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;kg kg-1&#39;</span>
<span class="n">qvapor</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;specific humidity&#39;</span>

<span class="n">ozone</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;o3&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">ozone</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;kg kg-1&#39;</span>
<span class="n">ozone</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;ozone mass mixing ratio&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="initial-sfc-conditions">
<h3>Initial sfc conditions<a class="headerlink" href="#initial-sfc-conditions" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">ps</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Pa&#39;</span>
<span class="n">ps</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;surface pressure&#39;</span>

<span class="n">thetas</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;thetas&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,))</span>
<span class="n">thetas</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
<span class="n">thetas</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;surface potential temperature&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-varying-forcing-geostrophic">
<h3>Time-varying forcing - geostrophic<a class="headerlink" href="#time-varying-forcing-geostrophic" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">do_geo</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ug</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ug&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
    <span class="n">ug</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m s-1&#39;</span>
    <span class="n">ug</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;geostrophic zonal wind&#39;</span>

    <span class="n">vg</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;vg&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
    <span class="n">vg</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m s-1&#39;</span>
    <span class="n">vg</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;geostrophic meridional wind&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-varying-forcing-nudging">
<h3>Time-varying forcing - nudging<a class="headerlink" href="#time-varying-forcing-nudging" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">do_u_v_nudge</span><span class="p">:</span>
    <span class="n">u_nudging</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;u_nudging&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
    <span class="n">u_nudging</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m s-1&#39;</span>
    <span class="n">u_nudging</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;zonal wind profile for nudging&#39;</span>

    <span class="n">v_nudging</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;v_nudging&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
    <span class="n">v_nudging</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m s-1&#39;</span>
    <span class="n">v_nudging</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;meridional wind profile for nudging&#39;</span>

<span class="k">if</span> <span class="n">do_th_qv_nudge</span><span class="p">:</span>
    <span class="n">theta_nudging</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;theta_nudging&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
    <span class="n">theta_nudging</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
    <span class="n">theta_nudging</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;potential temperature profile for nudging&#39;</span>

    <span class="n">qv_nudging</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;qv_nudging&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
    <span class="n">qv_nudging</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;kg kg-1&#39;</span>
    <span class="n">qv_nudging</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;specific humidity profile for nudging&#39;</span>
    
<span class="k">if</span> <span class="n">do_subsidence</span><span class="p">:</span>
    <span class="n">w_nudging</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;w_nudging&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
    <span class="n">w_nudging</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Pa s-1&#39;</span>
    <span class="n">w_nudging</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;vertical velocity for nudging&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-varying-forcing-surface">
<h3>Time-varying forcing - surface<a class="headerlink" href="#time-varying-forcing-surface" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ts&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
<span class="n">ts</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
<span class="n">ts</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;surface temperature&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-varying-locations">
<h3>Time-varying locations<a class="headerlink" href="#time-varying-locations" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">latitude_arr</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lat_ref&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
<span class="n">latitude_arr</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_north&#39;</span>
<span class="n">latitude_arr</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;reference latitude&#39;</span>

<span class="n">longitude_arr</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lon_ref&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
<span class="n">longitude_arr</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_east&#39;</span>
<span class="n">longitude_arr</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;reference longitude&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="misc">
<h3>Misc<a class="headerlink" href="#misc" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zw_grid</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;zw_grid&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;zw_grid&#39;</span><span class="p">,))</span>
<span class="n">zw_grid</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
<span class="n">zw_grid</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;grid altitude at cell faces&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="write-data">
<h2>Write data<a class="headerlink" href="#write-data" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t0_time</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">latitude</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">les_lat_mid</span>
<span class="n">longitude</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">les_lon_mid</span>
<span class="n">latitude_arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">les_lat2</span>
<span class="n">longitude_arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">les_lon2</span>
<span class="n">lev</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">zgeoi_shift</span>
<span class="n">zw_grid</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">z_grid</span>
<span class="n">pressure</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">pres_t0i</span>
<span class="n">u</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">ugeoi_t0i_mod</span>
<span class="n">v</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">vgeoi_t0i_mod</span>
<span class="n">temperature</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">temp_t0i</span>
<span class="n">ptemperature</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">theta_t0i</span>
<span class="n">qvapor</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">qv_t0i_mod</span>
<span class="n">ozone</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">o3_t0i</span>

<span class="n">ps</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">ps_t0</span>
<span class="n">thetas</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">thetas_t0</span>

<span class="k">if</span> <span class="n">do_geo</span><span class="p">:</span>
    <span class="n">ug</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">ugeoi</span>
    <span class="n">vg</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">vgeoi</span>

<span class="k">if</span> <span class="n">do_u_v_nudge</span><span class="p">:</span>
    <span class="n">u_nudging</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">unudgei</span>
    <span class="n">v_nudging</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">vnudgei</span>

<span class="k">if</span> <span class="n">do_th_qv_nudge</span><span class="p">:</span>
    <span class="n">theta_nudging</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">tnudgei</span>
    <span class="n">qv_nudging</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">qvnudgei</span>
    
<span class="k">if</span> <span class="n">do_subsidence</span><span class="p">:</span>
    <span class="n">w_nudging</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">wnudgei</span>
    
<span class="n">ts</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">sst_ts</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="add-times">
<h2>Add times<a class="headerlink" href="#add-times" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nhrs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">nhrs</span> <span class="o">==</span> <span class="mi">19</span><span class="p">:</span>
        <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">start_hour</span><span class="o">+</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">23</span><span class="p">:</span>
            <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="n">start_hour</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">24</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="n">start_hour</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">24</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="n">start_hour</span><span class="o">+</span><span class="n">i</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="n">start_hour</span><span class="o">+</span><span class="n">i</span><span class="p">))</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="n">time</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">times</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="close-the-file">
<h2>Close the file<a class="headerlink" href="#close-the-file" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first print the Dataset object to see what we&#39;ve got</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ncfile</span><span class="p">)</span>
<span class="c1"># close the Dataset.</span>
<span class="n">ncfile</span><span class="o">.</span><span class="n">close</span><span class="p">();</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dataset is closed!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;netCDF4._netCDF4.Dataset&#39;&gt;
root group (NETCDF3_CLASSIC data model, file format NETCDF3):
    title: Forcing and initial conditions for 13 March 2020 COMBLE intercomparison case
    reference: https://arm-development.github.io/comble-mip/
    authors: Timothy W. Juliano (NCAR/RAL, tjuliano@ucar.edu); Florian Tornow (NASA/GISS, ft2544@columbia.edu); Ann M. Fridlind (NASA/GISS, ann.fridlind@nasa.gov)
    version: Created on 2023-06-06
    format_version: DEPHY SCM format version 2.0
    script: create_comble_forcing_v2.1.ipynb
    comment: Simulations beginning prior to the ice edge set z0=0.001 m over ice then compute z0 using Charnock.
    startDate: 2020-03-12 22:00:00
    endDate: 2020-03-13 18:00:00
    forc_geo: 1
    radiation: on
    forc_wap: 1
    forc_wa: 0
    surface_type: landice-ocean
    surface_forcing_temp: ts
    surface_forcing_moisture: none
    surface_forcing_wind: z0-none
    lat: 74.5 deg N
    dx: 150 m
    dy: 150 m
    dz: see zw_grid variable
    nx: 648
    ny: 648
    nz: 160
    dimensions(sizes): t0(1), lat(1), lon(1), lev(136), zw_grid(160), time(21)
    variables(dimensions): float32 t0(t0), float32 lat(lat), float32 lon(lon), float64 time(time), float64 lev(lev), float64 pressure(t0,lev,lat,lon), float64 u(t0,lev,lat,lon), float64 v(t0,lev,lat,lon), float64 temp(t0,lev,lat,lon), float64 theta(t0,lev,lat,lon), float64 qv(t0,lev,lat,lon), float64 o3(t0,lev,lat,lon), float64 ps(t0,lat,lon), float64 thetas(t0,lat,lon), float64 ug(time,lev), float64 vg(time,lev), float64 u_nudging(time,lev), float64 v_nudging(time,lev), float64 theta_nudging(time,lev), float64 qv_nudging(time,lev), float64 w_nudging(time,lev), float64 ts(time), float32 lat_ref(time), float32 lon_ref(time), float64 zw_grid(zw_grid)
    groups: 
Dataset is closed!
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/forcing"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../../CONTRIBUTING.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Contributers Guide</p>
      </div>
    </a>
    <a class="right-next"
       href="../conversion/convert_comble_dephy_forcing_to_DHARMA_LES_and_ModelE3_SCM_forcing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Example: convert DEPHY forcing to DHARMA and ModelE3 forcings</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Code to generate: initial and time-varying profile and surface forcing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#developed-by-tim-juliano-ncar-ral-ann-fridlind-nasa-giss-and-florian-tornow-nasa-giss-columbia-univ">Developed by Tim Juliano (NCAR-RAL), Ann Fridlind (NASA-GISS), and Florian Tornow (NASA-GISS/Columbia Univ.)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#with-substantial-contributions-by-peng-wu-pnnl-gunilla-svensson-stockholm-univ-and-andy-ackerman-nasa-giss">with substantial contributions by Peng Wu (PNNL), Gunilla Svensson (Stockholm Univ.), and Andy Ackerman (NASA-GISS)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#v2-1-created-on-6-6-23">v2.1 created on 6/6/23</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#based-on-era5-backward-trajectory-beginning-at-andenes-norway-03-13-20-at-18-utc">Based on ERA5 backward trajectory, beginning at Andenes, Norway (03/13/20 at 18 UTC)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#we-have-the-option-of-starting-as-far-as-28-hours-before-arriving-at-andenes-03-12-20-at-14-utc">We have the option of starting as far as 28 hours before arriving at Andenes (03/12/20 at 14 UTC)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries">Import libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#begin-user-mods">!!! Begin user mods !!!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-hours-before-ice-edge-do-you-want-to-start">1. How many hours before ice edge do you want to start?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-value-0-means-you-are-starting-approx-at-ice-edge-value-10-means-you-are-starting-10-h-upstream-north-of-the-ice-edge">Note: Value == 0 means you are starting approx. at ice edge, Value == 10 means you are starting 10 h upstream (north) of the ice edge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-value-must-be-an-integer">Note: Value must be an integer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-t0-h-represents-simulation-start-time-t0-h-init-th-qv-represents-initial-theta-qv-profile-to-use-set-equivalent-if-everything-should-be-initialized-using-information-at-same-time">Note: t0_h represents simulation start time, t0_h_init_th_qv represents initial theta/qv profile to use; set equivalent if everything should be initialized using information at same time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clobber-old-forcing-file">2. Clobber old forcing file?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forcing-file-save-name">3. Forcing file save name</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-for-this-and-all-file-paths-include-directory-in-the-name">Note: For this and all file paths, include directory in the name</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#name-of-current-script-for-global-attribute">4. Name of current script for global attribute</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-can-use-ipynbname-library-to-automatically-generate-script-name-but-this-is-not-a-standard-library-so-skipping-for-now">Note: Can use ipynbname library to automatically generate script name, but this is not a standard library so skipping for now</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-domain-locations">5. LES domain locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#era5-backward-trajectory-met-file-name">6. ERA5 backward trajectory met file name</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#era5-backward-trajectory-ozone-file-name">7. ERA5 backward trajectory ozone file name</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-model-profiles-file-name">8. 1D model profiles file name</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sea-ice-concentration-file-name">9. Sea ice concentration file name</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-geostrophic-wind-calc-and-add-to-forcing-file-if-so-supply-era5-geopotential-height-file-name-and-minimum-grid-spacing-km-for-discretization">10. Do geostrophic wind calc and add to forcing file? If so, supply ERA5 geopotential height file name and minimum grid spacing (km) for discretization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-theta-and-qv-nudging-as-well-as-subsidence-to-forcing-file">11. Add theta and qv nudging, as well as subsidence, to forcing file?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#end-user-mods">!!! End user mods !!!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-some-things">Set some things</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timings">Timings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constants-for-geostrophic-wind-calc">Constants for geostrophic wind calc</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-forcing-file-if-already-exists">Delete forcing file if already exists</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-les-domain-locations">Get LES domain locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-vertical-grid">Create vertical grid</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#vertical-grid-levels-defined-at-the-cell-faces">160 vertical grid levels, defined at the cell faces</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-in-data-from-era5-backtrajectory-netcdf">Read in data from ERA5 backtrajectory (netCDF)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-units">Convert units</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reverse-time-dimension-of-2d-arrays-as-well-as-sfc-pressure-and-sst-so-that-beginning-of-backward-trajectory-is-in-first-position">Reverse time dimension of 2D arrays, as well as sfc pressure and sst, so that beginning of backward trajectory is in first position</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unmask-sst-field-and-get-index-according-to-t0-h-furthest-north-we-can-go-is-28h-after-backtrajectory-initialization-from-andenes-or-3-12-20-at-14-utc">Unmask sst field and get index according to t0_h (furthest north we can go is 28h after backtrajectory initialization from Andenes, or 3/12/20 at 14 UTC)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-sfc-potential-temperature">Calculate sfc potential temperature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-information-at-t0">Get information at t0</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extrapolate-o3-since-era5-only-goes-to-1-hpa-and-plot-versus-original-profile">Extrapolate O3 since ERA5 only goes to 1 hPa and plot versus original profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-geostrophic-wind-forcing">Get Geostrophic wind forcing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolate-extrapolate-ug-vg-to-native-era5-levels">Interpolate/extrapolate Ug/Vg to native ERA5 levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolate-t0-profiles-nudging-profiles-and-geostrophic-wind-profiles-to-common-vertical-grid-for-simplicity">Interpolate t0 profiles, nudging profiles, and geostrophic wind profiles to common vertical grid for simplicity</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#find-time-with-highest-first-level-and-get-vertical-grid">Find time with highest first level and get vertical grid</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#do-the-linear-interpolation-of-time-varying-geostrophic-profiles-to-new-vertical-grid">Do the linear interpolation of time-varying geostrophic profiles to new vertical grid</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-original-and-interpolated-profiles-of-time-varying-geostrophic-wind-as-example-to-show-efficacy-of-method">Compare original and interpolated profiles of time-varying geostrophic wind as example to show efficacy of method</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#do-the-linear-interpolation-for-initial-forcing-profiles">Do the linear interpolation for initial forcing profiles</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#do-the-linear-interpolation-for-nudging-forcing-profiles">Do the linear interpolation for nudging forcing profiles</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-original-and-interpolated-profiles-of-time-varying-nudging-wind-as-example-to-show-efficacy-of-method">Compare original and interpolated profiles of time-varying nudging wind as example to show efficacy of method</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#shift-profiles-downward-according-to-anns-method">Shift profiles downward according to Annâ€™s method</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smooth-shifted-initial-water-vapor-mixing-ratio-profile">Smooth shifted initial water vapor mixing ratio profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-1d-model-from-gunilla-svensson-approximate-deviation-from-geostrophy-and-add-offset-to-initial-geostrophic-winds-for-our-initial-wind-profile">Using 1D model from Gunilla Svensson, approximate deviation from geostrophy and add offset to initial geostrophic winds for our initial wind profile</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#do-sfc-forcing">DO SFC FORCING</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-sea-ice-concentration-along-trajectory">Calculate sea ice concentration along trajectory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-time-series-information-for-sfc-forcing">Get time series information for sfc forcing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-new-netcdf-file">Create new netcdf file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-dimensions">Create dimensions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-global-attributes">Create global attributes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-variables">Create variables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dimensions">Dimensions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-profiles">Initial profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-sfc-conditions">Initial sfc conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-forcing-geostrophic">Time-varying forcing - geostrophic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-forcing-nudging">Time-varying forcing - nudging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-forcing-surface">Time-varying forcing - surface</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-locations">Time-varying locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#misc">Misc</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#write-data">Write data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-times">Add times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#close-the-file">Close the file</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By ARM Development Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>